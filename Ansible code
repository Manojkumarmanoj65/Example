--- - hosts: all become: true gather_facts: True become_user: root tasks: - name: Include etcd base vars include_vars: etcd-vars.yml - name: install etcd and update ubuntu packages apt: name: etcd-server state: present update-cache: yes - name: install tls files from secrets ansible:buildin.copy: src: dest: /etc/pki/blaaaablaaa.cert owner: root group: mode: 600 - name: install tls files from secrets ansible:buildin.copy: src: dest: /etc/pki/blaaaablaaa.key owner: root group: mode: 600 - name: Write config file /etc/default/etcd.conf ansible.builtin.template: src: etcd.j2 dest: /etc/default/etcd.conf owner: root group: root mode: '0644' - name: build the initial cluster ansible.builtin.shell: | bla bla bla run the dns build commands here: touch /.somefile args: chdir: somedir creates: /.somefile - name: "Install azcopy" ansible.builtin.unarchive: src: "{{ azcopy_pkg_url }}" dest: /usr/local/bin mode: 0755 remote_src: yes exclude: - ThirdPartyNotice.txt - NOTICE.txt extra_opts: [--strip-components=1 ] - name: install azure credential ansible:buildin.copy: src: ( secrets ) dest: ( secrets ) owner: root group: mode: 600 - name: backup cron job for etcd-server ansible.bultin.cron: name: "etcd cron copy" special_time: daily user: job: "cd /tmp/$$ && etc backup && azcopy " - name: enable etcd and restart after the config is setup. systemd: name: etcd state: restarted enabled: True - name: Update all the packages on the machine apt:  name: "*" state: latest
